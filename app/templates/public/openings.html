{% extends 'base.html' %}

{% block title %}Job Openings - {{ organization.name }}{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/public-portal.css') }}">
{% endblock %}

{% block content %}
<div class="public-shell">
    <div class="public-hero">
        <div class="public-hero__logo">
            {% if organization.logo_path %}
                <img src="{{ url_for('static', filename=organization.logo_path) }}" alt="{{ organization.name }} logo">
            {% else %}
                <span class="public-hero__logo--placeholder">{{ organization.name[:2]|upper }}</span>
            {% endif %}
        </div>
        <div class="public-hero__content">
            <span class="public-pill">Now hiring</span>
            <h1>{{ organization.name }}</h1>
            <p>Discover current openings and join a team that’s redefining the candidate experience with AI-guided interviews.</p>
        </div>
    </div>

{% if jobs %}
        <div class="job-gallery">
            {% for job in jobs %}
            {% set published_date = job.published_at or job.created_at %}
            {% set summary_text = (job.description_html|striptags)|replace('\n', ' ') %}
            <article class="job-card">
                <div class="job-card__top">
                    <div>
                        <div class="job-card__posted">
                            {% if published_date %}
                                Published {{ published_date.strftime('%b %d, %Y') }}
                            {% else %}
                                Published recently
                            {% endif %}
                        </div>
                        <h3 class="job-card__title">{{ job.title }}</h3>
                    </div>
                </div>

                {% if summary_text %}
                <p class="job-card__description">
                    {{ summary_text|truncate(150, True, '…') }}
                </p>
                {% endif %}

                <div class="job-card__meta">
                    <div class="job-card__chips">
                        <span class="job-chip">{{ job.questions.count() }} interview questions</span>
                    </div>
                    <a class="public-button" href="{{ url_for('public.job_detail', org_slug=organization.slug, job_slug=job.public_url_slug) }}">
                        View Details
                    </a>
                </div>
            </article>
            {% endfor %}
        </div>
        {% if pagination and pagination.pages > 1 %}
        <nav class="public-pagination" aria-label="Job listings pagination">
            <ul class="public-pagination__list">
                {% if pagination.has_prev %}
                <li class="public-pagination__item">
                    <a class="public-pagination__link public-pagination__link--control" href="{{ url_for('public.organization_openings', org_slug=organization.slug, page=pagination.prev_num) }}" aria-label="Previous page">
                        ‹
                    </a>
                </li>
                {% endif %}
                {% for page_num in pagination.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
                    {% if page_num %}
                        <li class="public-pagination__item">
                            <a class="public-pagination__link {% if page_num == pagination.page %}public-pagination__link--active{% endif %}" href="{{ url_for('public.organization_openings', org_slug=organization.slug, page=page_num) }}">
                                {{ page_num }}
                            </a>
                        </li>
                    {% else %}
                        <li class="public-pagination__item public-pagination__item--ellipsis">…</li>
                    {% endif %}
                {% endfor %}
                {% if pagination.has_next %}
                <li class="public-pagination__item">
                    <a class="public-pagination__link public-pagination__link--control" href="{{ url_for('public.organization_openings', org_slug=organization.slug, page=pagination.next_num) }}" aria-label="Next page">
                        ›
                    </a>
                </li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}
    {% else %}
        <div class="empty-state">
            No open positions are available right now. Please check back soon or follow us on social for new roles.
        </div>
    {% endif %}
</div>
{% endblock %}

