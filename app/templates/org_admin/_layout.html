{% macro admin_layout(active_page, current_user) %}
<div class="layout-wrapper">
    <!-- Sidebar -->
    <aside class="layout-sidebar" id="layoutSidebar">
        <div class="sidebar-header">
            <a href="{{ url_for('org_admin.dashboard') }}" class="sidebar-brand">
                {% if current_user.organization.logo_path %}
                    <img src="{{ url_for('static', filename=current_user.organization.logo_path) }}" alt="Logo">
                {% else %}
                    <span class="sidebar-brand-text">{{ current_user.organization.name[:20] }}</span>
                {% endif %}
            </a>
        </div>
        <nav class="sidebar-menu">
            <div class="menu-section">
                <a href="{{ url_for('org_admin.dashboard') }}" class="menu-item {{ 'active' if active_page == 'dashboard' else '' }}">
                    <span class="menu-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="8" y1="12" x2="8" y2="16"></line>
                            <line x1="12" y1="8" x2="12" y2="16"></line>
                            <line x1="16" y1="10" x2="16" y2="16"></line>
                        </svg>
                    </span>
                    Dashboard
                </a>
                <a href="{{ url_for('org_admin.jobs') }}" class="menu-item {{ 'active' if active_page == 'jobs' else '' }}">
                    <span class="menu-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                            <rect x="2" y="16" width="20" height="6" rx="1"></rect>
                        </svg>
                    </span>
                    Jobs
                </a>
                <a href="{{ url_for('org_admin.applications') }}" class="menu-item {{ 'active' if active_page == 'applications' else '' }}">
                    <span class="menu-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10 9 9 9 8 9"></polyline>
                        </svg>
                    </span>
                    Applications
                </a>
                <a href="{{ url_for('org_admin.manage_team') }}" class="menu-item {{ 'active' if active_page == 'team' else '' }}">
                    <span class="menu-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                    </span>
                    Team
                </a>
            </div>
        </nav>
    </aside>
    
    <!-- Mobile Overlay -->
    <div class="mobile-overlay" id="mobileOverlay"></div>
    
    <!-- Main Content -->
    <div class="layout-content with-sidebar">
        <!-- Top Navbar -->
        <nav class="layout-navbar with-sidebar">
            <div class="navbar-content">
                <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Toggle Menu" type="button">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <div class="navbar-brand">
                    <h2>{{ current_user.organization.name }}</h2>
                </div>
                <div class="navbar-actions">
                    <a href="{{ url_for('auth.logout') }}" class="btn btn-secondary">Logout</a>
                </div>
            </div>
        </nav>
        
        <!-- Content -->
        <div class="content-wrapper">
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">{{ message }}</div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
            
            {{ caller() }}
        </div>
    </div>
</div>

<!-- Mobile Menu Script - Inline to ensure it loads -->
<script>
(function() {
    'use strict';
    
    // Wait for DOM to be ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initMobileMenu);
    } else {
        initMobileMenu();
    }
    
    function initMobileMenu() {
        const mobileMenuToggle = document.getElementById('mobileMenuToggle');
        const sidebar = document.getElementById('layoutSidebar');
        const mobileOverlay = document.getElementById('mobileOverlay');
        
        if (!mobileMenuToggle || !sidebar || !mobileOverlay) {
            console.warn('Mobile menu elements not found');
            return;
        }
        
        // Toggle menu on hamburger click
        mobileMenuToggle.addEventListener('click', function(e) {
            e.preventDefault();
            sidebar.classList.toggle('mobile-open');
            mobileOverlay.classList.toggle('active');
            this.classList.toggle('active');
            
            // Prevent body scroll when menu is open
            if (sidebar.classList.contains('mobile-open')) {
                document.body.style.overflow = 'hidden';
            } else {
                document.body.style.overflow = '';
            }
        });
        
        // Close menu on overlay click
        mobileOverlay.addEventListener('click', function() {
            sidebar.classList.remove('mobile-open');
            mobileOverlay.classList.remove('active');
            mobileMenuToggle.classList.remove('active');
            document.body.style.overflow = '';
        });
        
        // Close menu on menu item click (for better UX on mobile)
        const menuItems = sidebar.querySelectorAll('.menu-item');
        menuItems.forEach(function(item) {
            item.addEventListener('click', function() {
                if (window.innerWidth <= 968) {
                    sidebar.classList.remove('mobile-open');
                    mobileOverlay.classList.remove('active');
                    mobileMenuToggle.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });
        });
        
        // Handle window resize - close menu if switching to desktop
        let resizeTimer;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(function() {
                if (window.innerWidth > 968) {
                    sidebar.classList.remove('mobile-open');
                    mobileOverlay.classList.remove('active');
                    mobileMenuToggle.classList.remove('active');
                    document.body.style.overflow = '';
                }
            }, 250);
        });
    }
})();
</script>
{% endmacro %}

